(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{427:function(e,r,v){"use strict";v.r(r);var t=v(1),_=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("本文翻译自 "),r("a",{attrs:{href:"https://datamify.com/architecture/how-to-understand-cqrs-in-microservices-architecture/",target:"_blank",rel:"noopener noreferrer"}},[e._v("How To Understand CQRS In Microservices Architecture"),r("OutboundLink")],1),e._v("，作者 "),r("a",{attrs:{href:"https://datamify.com/author/vader/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OLEKSII"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("p",[e._v("在前一篇文章"),r("a",{attrs:{href:"https://datamify.com/architecture/how-to-implement-asynchronous-interactions-between-microservices/",target:"_blank",rel:"noopener noreferrer"}},[e._v("How To Implement Asynchronous Interactions Between Microservices"),r("OutboundLink")],1),e._v("中，讨论了通过消息代理进行微服务通信的一般思想。在本文中，将回顾微服务体系结构的一种特定模式，"),r("code",[e._v("CQRS")]),e._v("（Command Query Responsibility Segregation）。")]),e._v(" "),r("h2",{attrs:{id:"问题描述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[e._v("#")]),e._v(" 问题描述")]),e._v(" "),r("p",[e._v("在典型的软件应用程序中，有一个负责写入和读取操作的数据存储。通常，应用程序实现一些 "),r("code",[e._v("CRUD")]),e._v(" 操作，并且非常简单。你存储了一些东西并读取了相同的结果。")]),e._v(" "),r("p",[r("img",{attrs:{src:"/assets/img/CQRS-normal.jpg",alt:"img/CQRS-normal"}})]),e._v(" "),r("p",[e._v("然而，在复杂的应用程序中，情况并不是那么简单。每个"),r("code",[e._v("读（read）")]),e._v("和"),r("code",[e._v("写（write）")]),e._v("操作都需要很多操作和约束。")]),e._v(" "),r("p",[e._v("例如：")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("写（write）")]),e._v("：数据库是以规范化的方式构造的，以消除数据重复并强制约束。"),r("code",[e._v("读（read）")]),e._v("：复杂的读取查询需要大量对性能产生负面影响的联接（joins）/联合(unions)/聚合（aggregations）。")]),e._v(" "),r("li",[r("code",[e._v("读（read）")]),e._v("：优化查询需要索引。"),r("code",[e._v("写（write）")]),e._v("：每次"),r("code",[e._v("写（write）")]),e._v("操作都会更新索引。")]),e._v(" "),r("li",[e._v("读/写表示可能不同，这可能是附加逻辑的原因。")]),e._v(" "),r("li",[e._v("在对同一数据进行并行操作期间，可能会发生数据争用。")]),e._v(" "),r("li",[e._v("由于数据库的负载，性能可能很差。")])]),e._v(" "),r("h2",{attrs:{id:"cqrs"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cqrs"}},[e._v("#")]),e._v(" CQRS")]),e._v(" "),r("p",[e._v("上述问题的解决方案是 "),r("code",[e._v("CQRS")]),e._v("（Command Query Responsibility Segregation）。")]),e._v(" "),r("p",[r("img",{attrs:{src:"/assets/img/CQRS.jpg",alt:"CQRS"}})]),e._v(" "),r("p",[e._v("让我们回顾一下上面的图片。它包含两个服务："),r("em",[e._v("Hotel Management Service")]),e._v(" 和 "),r("em",[e._v("Hotel Read Service")]),e._v("（实际上，如果需要的话，可以有多个不同的 "),r("code",[e._v("Read services")]),e._v(" 及其各自的数据库）。这些服务之间的数据应该同步。为此，通常使用一些消息代理（例如 "),r("a",{attrs:{href:"https://kafka.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kafka"),r("OutboundLink")],1),e._v("）。这些服务的数据格式不同。")]),e._v(" "),r("p",[r("em",[e._v("Hotel Management Service")]),e._v(" 负责"),r("code",[e._v("创建")]),e._v("/"),r("code",[e._v("更新")]),e._v("/"),r("code",[e._v("删除")]),e._v("操作，每个操作都被描述为一个命令：")]),e._v(" "),r("ul",[r("li",[e._v("生成/批准/拒绝一个酒店创建请求。")]),e._v(" "),r("li",[e._v("添加/更新酒店房间到系统。")]),e._v(" "),r("li",[e._v("更改酒店房间的价格。")]),e._v(" "),r("li",[e._v("预订特定时间段的酒店房间。")]),e._v(" "),r("li",[e._v("请求其他服务。")]),e._v(" "),r("li",[e._v("生成请求留下/批准/拒绝评论。")]),e._v(" "),r("li",[e._v("取消预订。")])]),e._v(" "),r("p",[r("em",[e._v("Hotel Read Service")]),e._v(" 仅负责向用户显示酒店/房间列表：")]),e._v(" "),r("ul",[r("li",[e._v("列出一个城市中所有/可用的酒店房间。")]),e._v(" "),r("li",[e._v("在地图上显示所有酒店（按地理位置过滤）。")]),e._v(" "),r("li",[e._v("向用户显示可用的过滤选项。")]),e._v(" "),r("li",[e._v("通过指定的过滤器过滤酒店房间（例如，显示两个酒店房间，而不是一个多人房间）。")])]),e._v(" "),r("p",[e._v("正如你所见，服务提供的责任是不同的。此外，指定服务的性能约束也不同。用户在预订之前通常会经过许多预订选项。因此，在这个系统中，"),r("code",[e._v("读（read）")]),e._v("操作的数量远远高于"),r("code",[e._v("写（write）")]),e._v("操作的数量。因此，这些服务的缩放将有所不同。")]),e._v(" "),r("p",[e._v("因此，一些 "),r("code",[e._v("RDBMS")]),e._v(" 可以用作 "),r("em",[e._v("Hotel Management Service")]),e._v(" 的数据存储，例如 "),r("a",{attrs:{href:"https://www.mysql.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("MySQL"),r("OutboundLink")],1),e._v(" 或 "),r("a",{attrs:{href:"https://www.postgresql.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("PosgreSQL"),r("OutboundLink")],1),e._v("。"),r("code",[e._v("RDBMS")]),e._v(" 将为保持数据安全提供它的所有好处。")]),e._v(" "),r("p",[r("em",[e._v("Hotel Read Service")]),e._v(" 可以基于一些 "),r("code",[e._v("NoSQL")]),e._v(" 解决方案，如 "),r("a",{attrs:{href:"https://www.mongodb.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("MongoDB"),r("OutboundLink")],1),e._v("或 "),r("a",{attrs:{href:"https://www.elastic.co/elasticsearch/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Elasticsearch"),r("OutboundLink")],1),e._v("。这背后的原因是执行高效搜索查询的能力：反规范化、地理位置搜索支持、索引、水平缩放等。")]),e._v(" "),r("h3",{attrs:{id:"cqrs-优势"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cqrs-优势"}},[e._v("#")]),e._v(" CQRS 优势")]),e._v(" "),r("ul",[r("li",[e._v("关注点分离。")]),e._v(" "),r("li",[e._v("单个读写服务缩放。")]),e._v(" "),r("li",[e._v("适合读写操作的数据存储及其模式（schema）。")]),e._v(" "),r("li",[e._v("简单高效的查询。")])]),e._v(" "),r("h3",{attrs:{id:"cqrs-劣势"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cqrs-劣势"}},[e._v("#")]),e._v(" CQRS 劣势")]),e._v(" "),r("ul",[r("li",[e._v("复杂性。")]),e._v(" "),r("li",[e._v("最终一致性。")])]),e._v(" "),r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),r("p",[e._v("在本文中，我们回顾了 "),r("code",[e._v("CQRS")]),e._v(" 模式。值得一提的是，这种模式的必要性可能发生在复杂的系统中。因此，应谨慎选择，以免给系统带来不必要的复杂性。")])])}),[],!1,null,null,null);r.default=_.exports}}]);