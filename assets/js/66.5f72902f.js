(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{442:function(v,_,e){"use strict";e.r(_);var t=e(1),o=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("blockquote",[_("p",[v._v("本文翻译自 "),_("a",{attrs:{href:"https://datamify.com/architecture/how-to-implement-synchronous-interactions-between-microservices/",target:"_blank",rel:"noopener noreferrer"}},[v._v("How To Implement Synchronous Interactions Between Microservices"),_("OutboundLink")],1),v._v("，原作者：OLEKSII")])]),v._v(" "),_("p",[v._v("在之前的文章《如何理解微服务架构》中，我们回顾了微服务架构的优缺点。在采用这种架构构建的应用程序中，服务之间的交互可能是一个挑战。实现这种交互有不同的方法。在本篇文章中，我们将回顾同步交互（HTTP/HTTPS）。")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://images-1318308994.cos.ap-chengdu.myqcloud.com/article/20240109095247.png",alt:""}})]),v._v(" "),_("h2",{attrs:{id:"同步微服务交互"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#同步微服务交互"}},[v._v("#")]),v._v(" 同步微服务交互")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://images-1318308994.cos.ap-chengdu.myqcloud.com/article/20240109100822.png",alt:""}})]),v._v(" "),_("p",[v._v("让我们回顾一下上面的示例。在本例中，我们采用的是"),_("code",[v._v("每个服务一个数据库")]),v._v("模式。这意味着服务不共享数据库。每个服务都有自己的数据库或根本没有数据库。")]),v._v(" "),_("h2",{attrs:{id:"同步微服务交互示例"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#同步微服务交互示例"}},[v._v("#")]),v._v(" 同步微服务交互示例")]),v._v(" "),_("p",[v._v("用户访问酒店预订网站并选择入住日期。"),_("code",[v._v("Hotel Service（酒店服务）")]),v._v(" 只返回一个包含尽可能少的酒店客房信息的列表。然后，用户选择一个特定的酒店客房。因此，我们需要输入酒店客房和入住日期。预计将返回完整的酒店信息：")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("酒店摘要")]),v._v("。例如，名称、地址、评级、描述、可用服务、房间描述等。"),_("code",[v._v("Hotel Service（酒店服务）")]),v._v("使用自己的数据库获取所需数据。")]),v._v(" "),_("li",[_("strong",[v._v("酒店附近的景点")]),v._v("。可以是餐厅、剧院、电影院、博物馆等。这些信息通常不会更改。因此，这些信息可以保存在 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("数据库中。")]),v._v(" "),_("li",[_("strong",[v._v("酒店附近的活动")]),v._v("。这些是不时发生的事件。"),_("code",[v._v("第三方事件服务")]),v._v("可用于获取入住期间酒店附近的活动（如节日、音乐会、展览等）。")])]),v._v(" "),_("p",[v._v("总之，响应包含来自三个不同服务的数据，它们通过 "),_("code",[v._v("HTTP/HTTPS")]),v._v("  进行同步通信。")]),v._v(" "),_("h2",{attrs:{id:"同步微服务模式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#同步微服务模式"}},[v._v("#")]),v._v(" 同步微服务模式")]),v._v(" "),_("p",[v._v("乍一看，从"),_("code",[v._v("Hotel Service（酒店服务）")]),v._v(" 向 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v(" 以及从 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v(" 向"),_("code",[v._v("第三方事件服务")]),v._v(" 发出请求似乎就足够了。然而，这种微服务交互方法存在一些常见问题。")]),v._v(" "),_("h2",{attrs:{id:"服务发现"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#服务发现"}},[v._v("#")]),v._v(" 服务发现")]),v._v(" "),_("p",[v._v("第一个问题是 "),_("code",[v._v("Hotel Service（酒店服务）")]),v._v(" 不能直接调用 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("（我们不能硬编码服务 URL）。为了提供稳定的服务，同一服务的多个实例应并行运行。实例的数量可根据负载情况增减，不健康的实例会被健康的实例取代。因此，一些基础设施组件应负责活动服务及其活动健康实例的列表。"),_("code",[v._v("服务发现")]),v._v(" 就是用于此目的。有关运行服务实例的信息保存在"),_("em",[v._v("服务注册")]),v._v("中。")]),v._v(" "),_("p",[v._v("例如，在 Spring 体系中就是 Eureka。")]),v._v(" "),_("h2",{attrs:{id:"客户端负载均衡"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#客户端负载均衡"}},[v._v("#")]),v._v(" 客户端负载均衡")]),v._v(" "),_("p",[v._v("使用"),_("code",[v._v("服务注册")]),v._v("的第一个选项是"),_("code",[v._v("客户端负载均衡")]),v._v("。")]),v._v(" "),_("p",[v._v("这意味着什么？我们的"),_("code",[v._v("服务注册")]),v._v("提供有关健康实例的信息。"),_("code",[v._v("Hotel Service（酒店服务）*")]),v._v("可与"),_("code",[v._v("服务注册")]),v._v("交互，以查找 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v(" 的活动服务实例，并使用某种算法来选择要使用的实例（如：循环演算法）。")]),v._v(" "),_("p",[v._v("调用将被执行到选定的服务实例。")]),v._v(" "),_("p",[v._v("在 Spring 中 通常是 Ribbon。")]),v._v(" "),_("h2",{attrs:{id:"网关"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网关"}},[v._v("#")]),v._v(" 网关")]),v._v(" "),_("p",[v._v("使用"),_("code",[v._v("服务注册")]),v._v("的第二种方法是使用网关（如文章开始的图片所示）。")]),v._v(" "),_("p",[v._v("在这种情况下，一个特殊组件负责将请求重定向到所需的服务实例。网关与服务注册中心合作，了解哪些服务及其实例可以使用。")]),v._v(" "),_("p",[v._v("例如，它可以这样工作：")]),v._v(" "),_("ul",[_("li",[v._v("用户（个人或其他服务）调用，如： "),_("code",[v._v("GET https://hotelbookingapplication.com/api/hotel-attractions?lattitude=15.45656&longitude=-18.99908")]),v._v(" 等服务。")]),v._v(" "),_("li",[_("code",[v._v("hotel-attractions")]),v._v(" 路径表明服务信息。")]),v._v(" "),_("li",[_("em",[v._v("网关")]),v._v("查找有关 "),_("code",[v._v("hotel-attractions")]),v._v(" 服务的信息。")]),v._v(" "),_("li",[v._v("找到正在运行的 "),_("code",[v._v("hotel-attractions")]),v._v(" 服务实例的 URL。")]),v._v(" "),_("li",[v._v("例如，使用循环演算法选择一个实例并发出请求。")])]),v._v(" "),_("p",[v._v("在 Spring 中通常是 Zuul。")]),v._v(" "),_("h2",{attrs:{id:"断路器"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#断路器"}},[v._v("#")]),v._v(" 断路器")]),v._v(" "),_("p",[v._v("让我们回顾一下同步微服务交互的另一个问题。")]),v._v(" "),_("p",[v._v("在我们的示例中，将执行下一个请求序列：")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("向酒店景点服务发出请求。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("向 "),_("code",[v._v("第三方事件服务")]),v._v("发出请求。")])]),v._v(" "),_("p",[v._v("如您所见，该请求取决于三项服务。此外，"),_("code",[v._v("第三方事件服务")]),v._v("不在我们的控制范围之内。")]),v._v(" "),_("p",[v._v("如果其中一个服务运行缓慢，会发生什么情况？它会对整个应用程序产生什么影响？")]),v._v(" "),_("p",[v._v("问题在于，即使一个服务出现问题，也会对整个系统的性能产生负面影响。")]),v._v(" "),_("p",[v._v("试想一下"),_("code",[v._v("第三方事件服务")]),v._v("宕机时的情况。在这种情况下，用户甚至无法看到酒店客房信息。没错，"),_("code",[v._v("第三方事件服务")]),v._v("提供的酒店附近活动信息对某些人来说可能很重要。但是，这并不重要。没有这些信息，人们仍然可以预订酒店房间。")]),v._v(" "),_("p",[v._v("如果"),_("code",[v._v("第三方事件服务")]),v._v("性能不佳，情况就会更糟。")]),v._v(" "),_("p",[v._v("想象以下的情景：")]),v._v(" "),_("ul",[_("li",[v._v("向"),_("code",[v._v("Hotel Service（酒店服务）")]),v._v("提出申请。")]),v._v(" "),_("li",[v._v("从"),_("code",[v._v("Hotel Service（酒店服务）")]),v._v(" 向"),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v(" 发出请求。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("向"),_("code",[v._v("第三方事件服务")]),v._v("发出请求。")]),v._v(" "),_("li",[_("code",[v._v("第三方事件服务")]),v._v("在 30 秒内响应。")])]),v._v(" "),_("p",[v._v("因此：")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("阻塞线程，等待"),_("code",[v._v("第三方事件服务")]),v._v("的响应。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("阻塞线程，等待"),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v(" 的响应。")])]),v._v(" "),_("p",[v._v("在单个请求的情况下，并不会发生什么严重的情况：用户只需等待大约 30 秒的响应。")]),v._v(" "),_("p",[v._v("然而，这里有两个主要问题：")]),v._v(" "),_("ul",[_("li",[v._v("不是每个用户都会等待 30 秒。")]),v._v(" "),_("li",[v._v("有关酒店附近活动的信息并不重要。")])]),v._v(" "),_("p",[v._v("当我们看到真实情况时，情况会变得更糟：用户提出的请求不止一个。很多用户都在寻找酒店房间。")]),v._v(" "),_("p",[v._v("这意味着这 30 秒的等待时间会对整个系统的性能产生负面影响：")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("资源已耗尽。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("更加等待 "),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("的响应。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("的资源耗尽。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("无法处理与既未使用"),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("也未使用"),_("code",[v._v("第三方事件服务")]),v._v("的酒店房间列表相关的请求。")])]),v._v(" "),_("p",[v._v("解决方案非常简单。使用断路器。")]),v._v(" "),_("ul",[_("li",[v._v("为每个请求设置超时。")]),v._v(" "),_("li",[v._v("如果一个服务在超时前未收到另一个服务的响应，则初始服务将以默认值响应。")]),v._v(" "),_("li",[v._v("在某个配置的时间段内，不会向有问题的服务发出请求。始终使用默认响应。")]),v._v(" "),_("li",[v._v("一段时间后，再次向相关服务发出请求。")])]),v._v(" "),_("p",[v._v("让我们回顾一下第三方活动服务出现问题时的情况（同样适用于酒店景点服务）。")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("向"),_("code",[v._v("Hotel Attractions Service（酒店景点服务）")]),v._v("发出请求。")]),v._v(" "),_("li",[_("code",[v._v("Hotel Service（酒店服务）")]),v._v("向第三方活动服务发出请求，等待响应 1 秒钟。")]),v._v(" "),_("li",[v._v("如果收到成功响应，则一切正常。用户收到所有数据。")]),v._v(" "),_("li",[v._v("如果响应不成功，用户将不会收到有关事件的信息。后续请求（例如下一个 5 秒）将跳过对有问题的"),_("code",[v._v("第三方事件服务")]),v._v("的调用。")])]),v._v(" "),_("p",[v._v("在 Spring 中，典型的是 Hystrix。")]),v._v(" "),_("h2",{attrs:{id:"缓存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[v._v("#")]),v._v(" 缓存")]),v._v(" "),_("p",[v._v("为了优化性能特征，在某些情况下可以使用缓存。")]),v._v(" "),_("p",[v._v("如果可能，可以出于以下原因使用缓存：")]),v._v(" "),_("ul",[_("li",[v._v("跳过对目标服务的调用。")]),v._v(" "),_("li",[v._v("在目标服务出现问题时，可以向用户返回一些默认数据（可能是过时或不准确的数据）。")])]),v._v(" "),_("p",[v._v("不过，缓存失效可能是一个真正的挑战。")]),v._v(" "),_("h2",{attrs:{id:"总结"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),_("p",[v._v("本文介绍了同步微服务交互面临的各种挑战。这种方法在某些情况下是适用的。不过，还有另一种微服务通信方式。下一篇文章将讨论异步微服务交互。")])])}),[],!1,null,null,null);_.default=o.exports}}]);