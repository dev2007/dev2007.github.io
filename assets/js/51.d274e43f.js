(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{424:function(a,s,t){"use strict";t.r(s);var e=t(1),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("在上一篇中，我们针对索引 API 相关管理 API 进行了总结，包括常见的 "),s("code",[a._v("CRUD")]),a._v(" 及 Elasticsearch 特殊的 API。其中，我们提到，在 Elasticsearch 中，没有直接针对索引本身的“修改” API，而只能修改索引相关的属性。本篇，将介绍与属性相关的 API。")]),a._v(" "),s("p",[a._v("索引的属性主要包括："),s("code",[a._v("Mapping")]),a._v("（映射）、"),s("code",[a._v("Alias")]),a._v("（别名）、"),s("code",[a._v("Setting")]),a._v("（设置）。对索引的修改，也多是针对此三种属性进行的。")]),a._v(" "),s("h2",{attrs:{id:"映射管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#映射管理"}},[a._v("#")]),a._v(" 映射管理")]),a._v(" "),s("p",[a._v("映射相关的 API 包括有查询映射、修改映射，以及特殊的查询字段映射及查询类型存在。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("查询映射")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /_mapping\n\nGET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_mapping\n")])])]),s("p",[a._v("使用 "),s("code",[a._v("GET")]),a._v(" 方法，API 关键字为 "),s("code",[a._v("_mapping")]),a._v("，中间参数是索引名字，可以用通配符代表所有索引，或者用逗号分隔多个索引名字，如果不指定，代表查询所有索引的映射。")])]),a._v(" "),s("li",[s("p",[a._v("修改映射")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("PUT /my-index-000001/_mapping\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"email"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"keyword"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("使用 "),s("code",[a._v("PUT")]),a._v(" 方法，中间参数是索引名字，可以用通配符代表所有索引，也可以用逗号分隔多个索引名字，请求体中为要修改的映射的字段。")]),a._v(" "),s("p",[a._v("要注意，此方法用于"),s("strong",[a._v("添加新的字段")]),a._v("以及"),s("strong",[a._v("对已有字段添加新的属性")]),a._v("，而不是真的修改已有字段的属性。")]),a._v(" "),s("p",[a._v("如果想要修改一个已有字段的属性，官方推荐方式如下：")]),a._v(" "),s("blockquote",[s("p",[a._v("1.创建一个正确的新索引")]),a._v(" "),s("p",[a._v("2.把数据重索引到新索引")]),a._v(" "),s("p",[a._v("3.删除旧索引")]),a._v(" "),s("p",[a._v("参阅 "),s("a",{attrs:{href:"https://elasticsearch.bookhub.tech/#/rest_apis/index_apis/update_mapping?id=%e4%bf%ae%e6%94%b9%e5%b7%b2%e6%9c%89%e5%ad%97%e6%ae%b5%e7%9a%84%e6%98%a0%e5%b0%84",target:"_blank",rel:"noopener noreferrer"}},[a._v("变更已有字段的映射"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("如果想要修改一个已有字段的名字，官方推荐方法如下：")]),a._v(" "),s("blockquote",[s("p",[a._v("添加一个别名来替代字段名字")]),a._v(" "),s("p",[a._v("参阅"),s("a",{attrs:{href:"https://elasticsearch.bookhub.tech/#/rest_apis/index_apis/update_mapping?id=%e9%87%8d%e5%91%bd%e5%90%8d%e5%ad%97%e6%ae%b5",target:"_blank",rel:"noopener noreferrer"}},[a._v("重命名字段"),s("OutboundLink")],1)])])]),a._v(" "),s("li",[s("p",[a._v("查询字段映射")]),a._v(" "),s("p",[a._v("此 API  在“查询映射”的基础，查询更细的“字段”的映射。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /_mapping/field/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("field"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nGET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_mapping/field/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("field"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("GET")]),a._v("，API 关键字为 "),s("code",[a._v("/_mapping/field")]),a._v("。参数为索引名字和字段名字。如果不指定索引，代表查询所有索引下相应字段的映射。在 Elasticsearch 中，很多名字的查询都支持模糊查询，所以这里的索引名字、字段名字，可以是模糊查询（如："),s("code",[a._v("acc*")]),a._v("）。")])]),a._v(" "),s("li",[s("p",[a._v("查询类型存在")]),a._v(" "),s("p",[a._v("从 7.0.0 版本开始，此 API 不再被推荐。")]),a._v(" "),s("p",[a._v("此 API 主要是用于查询映射的类型是否存在。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("HEAD /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_mapping/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("HEAD")]),a._v("，API 关键字为 "),s("code",[a._v("_mapping")]),a._v("，参数为索引名字和类型。如果查到有，响应码为 "),s("code",[a._v("200")]),a._v("，没查到，响应码为 "),s("code",[a._v("404")]),a._v("。")])])]),a._v(" "),s("h2",{attrs:{id:"别名管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#别名管理"}},[a._v("#")]),a._v(" 别名管理")]),a._v(" "),s("p",[a._v("别名相关 API 主要有创建别名、修改别名、查询别名和删除别名。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("别名 API")]),a._v(" "),s("p",[a._v("此 API 可以通过在请求体指定不同的 "),s("code",[a._v("action")]),a._v(" 实现对别名的创建、删除和修改（通过在一个请求中删除的同时又创建），还能使用日期数学，实现动态的别名创建。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("POST /_aliases\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"actions"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"add"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"index"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"my-index-000001"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"alias"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"alias1"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("创建、修改别名")]),a._v(" "),s("p",[a._v("此 API 可以创建或修改索引的别名。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("PUT /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_alias/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nPOST /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_alias/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nPUT /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_aliases/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nPOST /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_aliases/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法支持 "),s("code",[a._v("PUT")]),a._v(" 和 "),s("code",[a._v("POST")]),a._v("，API 中关键字为 "),s("code",[a._v("_alias")]),a._v(" 或 "),s("code",[a._v("_aliases")]),a._v("。参数分别代表索引名字和别名。")]),a._v(" "),s("p",[a._v("如果进一步在请求体中使用过滤器，还能实现针对指定数据添加别名。")])]),a._v(" "),s("li",[s("p",[a._v("查询索引别名")]),a._v(" "),s("p",[a._v("此 API 可以查询索引别名。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /_alias\n\nGET /_alias/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nGET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_alias/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("GET")]),a._v("，API 中关键字为 "),s("code",[a._v("_alias")]),a._v("。参数分别代表索引名字和别名，如果索引名字不指定，就代表所有索引。索引名字也可以使用通配符代表所有索引。")])]),a._v(" "),s("li",[s("p",[a._v("删除索引别名")]),a._v(" "),s("p",[a._v("此 API 可以删除索引别名。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("DELETE /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_alias/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nDELETE /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_aliases/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("DELETE")]),a._v("，API 中关键字为 "),s("code",[a._v("_alias")]),a._v(" 或 "),s("code",[a._v("_aliases")]),a._v("。参数分别为索引名字和别名。索引名字也可以使用通配符代表所有索引。")])])]),a._v(" "),s("h2",{attrs:{id:"索引设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引设置"}},[a._v("#")]),a._v(" 索引设置")]),a._v(" "),s("p",[a._v("设置相关 API 包括查询设置、修改设置以及特殊的分析 API。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("查询设置")]),a._v(" "),s("p",[a._v("此 API 查询索引的设置（"),s("code",[a._v("setting")]),a._v("）。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_settings\n\nGET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("target"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_settings/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("setting"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("GET")]),a._v("，API 中关键字为 "),s("code",[a._v("_settings")]),a._v("。参数分别为索引名字和设置名字。不指定索引名字，就代表所有索引，不指定设置名字，就代表所有设置。索引名字和设置名字都支持通配符，通配符代表所有。")])]),a._v(" "),s("li",[s("p",[a._v("修改设置")]),a._v(" "),s("p",[a._v("此 API 修改"),s("strong",[a._v("动态索引设置")]),a._v("。（一定要注意的是，只有符合 Elasticsearch 规定的动态索引设置才能在索引创建后修改）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("PUT /my-index-000001/_settings\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"index"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"number_of_replicas"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("PUT")]),a._v("，API 中关键字为 "),s("code",[a._v("_settings")]),a._v("。参数为索引名字。请求体中为要修改的设置。")])]),a._v(" "),s("li",[s("p",[a._v("分析 API")]),a._v(" "),s("p",[a._v("此 API 用于分析文本。（从学到这里的程度看，和设置本身关系并不大，因为此 API 是用于直接指定分析器对文本进行分析，或者在索引上进行分析。可能学到后面才能理解官方将其放在这里的原因）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /_analyze\n\nPOST /_analyze\n\nGET /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_analyze\n\nPOST /"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/_analyze\n")])])]),s("p",[a._v("方法为 "),s("code",[a._v("GET")]),a._v(" 或 "),s("code",[a._v("POST")]),a._v("，API 中关键字为 "),s("code",[a._v("_analyze")]),a._v("，参数为索引名字。")]),a._v(" "),s("p",[a._v("示例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("GET /_analyze\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"analyzer"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"standard"')]),a._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"text"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Quick Brown Foxes!"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])])]),a._v(" "),s("p",[a._v("以上，就是索引本身属性相关的 API，包括映射、别名、设置。")])])}),[],!1,null,null,null);s.default=n.exports}}]);