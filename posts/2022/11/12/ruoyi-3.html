<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹ä¸‰ | é˜¿å‘œçš„è¾¹åŸ-Awu&#39;s World</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon/favicon.ico">
    <meta name="description" content="åˆ†äº«ä¸€åˆ‡ä¸å¼€å‘ç¼–ç¨‹ä»¥åŠå¼€å‘è€…ç›¸å…³çš„æ–‡ç« ã€‚å¾®ä¿¡å…¬ä¼—å·ï¼šç¨‹åºå‘˜çˆ±è¯»ä¹¦">
    <meta name="keywords" content="å¼€å‘è€…,ç¨‹åºå‘˜,ç¨‹åºçŒ¿,ç¨‹åºåª›,æå®¢,ç å†œ,ç¼–ç¨‹,ä»£ç ,è½¯ä»¶å¼€å‘,å¼€æº,ITç½‘ç«™,æŠ€æœ¯ç¤¾åŒº,Developer,Programmer,Coder,Geek,Coding,Code,é˜¿å‘œçš„è¾¹ç¨‹,é˜¿å‘œçš„ç¼–ç¨‹">
    <link rel="preload" href="/assets/css/0.styles.4630dd33.css" as="style"><link rel="preload" href="/assets/js/app.467e2829.js" as="script"><link rel="preload" href="/assets/js/7.4e539d82.js" as="script"><link rel="preload" href="/assets/js/59.67f1a597.js" as="script"><link rel="prefetch" href="/assets/js/1.7e906b04.js"><link rel="prefetch" href="/assets/js/10.e0248698.js"><link rel="prefetch" href="/assets/js/12.e538132d.js"><link rel="prefetch" href="/assets/js/13.2a2f676b.js"><link rel="prefetch" href="/assets/js/14.214a405f.js"><link rel="prefetch" href="/assets/js/15.f38aa5fe.js"><link rel="prefetch" href="/assets/js/16.f1929af0.js"><link rel="prefetch" href="/assets/js/17.07d76279.js"><link rel="prefetch" href="/assets/js/18.d6db1d2b.js"><link rel="prefetch" href="/assets/js/19.84710e5e.js"><link rel="prefetch" href="/assets/js/2.7ac2fab1.js"><link rel="prefetch" href="/assets/js/20.f959fe80.js"><link rel="prefetch" href="/assets/js/21.2fd86fda.js"><link rel="prefetch" href="/assets/js/22.c77ef176.js"><link rel="prefetch" href="/assets/js/23.8a8ffe22.js"><link rel="prefetch" href="/assets/js/24.b6c2e323.js"><link rel="prefetch" href="/assets/js/25.6fd04512.js"><link rel="prefetch" href="/assets/js/26.2974a93c.js"><link rel="prefetch" href="/assets/js/27.7a62c283.js"><link rel="prefetch" href="/assets/js/28.f8974e73.js"><link rel="prefetch" href="/assets/js/29.cb3e8910.js"><link rel="prefetch" href="/assets/js/3.9254d7f5.js"><link rel="prefetch" href="/assets/js/30.bf6a36b7.js"><link rel="prefetch" href="/assets/js/31.5dec5686.js"><link rel="prefetch" href="/assets/js/32.8a42b4c0.js"><link rel="prefetch" href="/assets/js/33.83abd616.js"><link rel="prefetch" href="/assets/js/34.ee89ddca.js"><link rel="prefetch" href="/assets/js/35.23327e0c.js"><link rel="prefetch" href="/assets/js/36.d1398816.js"><link rel="prefetch" href="/assets/js/37.831600d9.js"><link rel="prefetch" href="/assets/js/38.71dccc31.js"><link rel="prefetch" href="/assets/js/39.9368b3e2.js"><link rel="prefetch" href="/assets/js/4.1a846bb9.js"><link rel="prefetch" href="/assets/js/40.96d1de0d.js"><link rel="prefetch" href="/assets/js/41.4bc03f21.js"><link rel="prefetch" href="/assets/js/42.c6c92807.js"><link rel="prefetch" href="/assets/js/43.89080e02.js"><link rel="prefetch" href="/assets/js/44.66cfb85b.js"><link rel="prefetch" href="/assets/js/45.a7e3d8ae.js"><link rel="prefetch" href="/assets/js/46.9d784267.js"><link rel="prefetch" href="/assets/js/47.88a828fd.js"><link rel="prefetch" href="/assets/js/48.a62bea2b.js"><link rel="prefetch" href="/assets/js/49.ea543004.js"><link rel="prefetch" href="/assets/js/5.96353e26.js"><link rel="prefetch" href="/assets/js/50.eba5af66.js"><link rel="prefetch" href="/assets/js/51.d274e43f.js"><link rel="prefetch" href="/assets/js/52.4443a52d.js"><link rel="prefetch" href="/assets/js/53.4112b49f.js"><link rel="prefetch" href="/assets/js/54.98363e68.js"><link rel="prefetch" href="/assets/js/55.87360021.js"><link rel="prefetch" href="/assets/js/56.e8482afd.js"><link rel="prefetch" href="/assets/js/57.d4ee3fcd.js"><link rel="prefetch" href="/assets/js/58.69071d3d.js"><link rel="prefetch" href="/assets/js/6.8c198353.js"><link rel="prefetch" href="/assets/js/60.c40c582e.js"><link rel="prefetch" href="/assets/js/61.f1757ef1.js"><link rel="prefetch" href="/assets/js/62.13c89e9c.js"><link rel="prefetch" href="/assets/js/63.6ad00547.js"><link rel="prefetch" href="/assets/js/64.a2915c89.js"><link rel="prefetch" href="/assets/js/65.f3caf203.js"><link rel="prefetch" href="/assets/js/66.5f72902f.js"><link rel="prefetch" href="/assets/js/67.c5106e01.js"><link rel="prefetch" href="/assets/js/68.c0662345.js"><link rel="prefetch" href="/assets/js/69.67072028.js"><link rel="prefetch" href="/assets/js/70.19b64377.js"><link rel="prefetch" href="/assets/js/71.f52a0e24.js"><link rel="prefetch" href="/assets/js/8.b31a6a19.js"><link rel="prefetch" href="/assets/js/9.e4ce902a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4630dd33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/cloud.jpg);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          é˜¿å‘œçš„è¾¹åŸ-Awu's World
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/" class="navbar-link" data-v-e4145d0a>
            ç¨‹åºå‘˜çˆ±è¯»ä¹¦
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            æ–‡ç« åˆ—è¡¨
          </a><a href="https://github.com/dev2007" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-e4145d0a><span data-v-e4145d0a>GitHub</span> <span data-v-e4145d0a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://micronaut.bookhub.tech" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-e4145d0a><span data-v-e4145d0a>Micronaut</span> <span data-v-e4145d0a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹ä¸‰
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      å‘å¸ƒæ—¶é—´ : 2022-11-12
    </span> <!----></section> <section class="post-links" data-v-4e23451f><a href="/posts/2022/10/28/ruoyi-2.html" class="post-link" data-v-4e23451f>
      ä¸Šä¸€ç¯‡ : æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹äºŒ
    </a> <a href="/posts/2022/11/23/ruoyi-4.html" class="post-link" data-v-4e23451f>
      ä¸‹ä¸€ç¯‡ : æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹å››
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><p>ä¸Šç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆæ­¥æ¢ç©¶äº† RuoYi é¡¹ç›®æ˜¯å¦‚ä½•è¿›è¡Œç™»å½•ä¿¡æ¯ä¼ è¾“ã€éªŒè¯ç æ ¡éªŒã€å¯†ç æ ¡éªŒï¼Œä»¥åŠå¯†ç å­˜å‚¨å®‰å…¨æ€§æ–¹æ¡ˆã€‚æˆ‘ä»¬äº†è§£åˆ°ï¼Œæ•´ä¸ªçš„éªŒè¯å®ç°æ˜¯å›´ç»• Shiro æ¡†æ¶è¿›è¡Œçš„ï¼Œè€Œæ•°æ®çš„ä¼ è¾“å®‰å…¨æ€§ï¼ŒRuoYi æ˜¯æ²¡æœ‰è€ƒè™‘çš„ï¼Œå¦‚æœæˆ‘ä»¬åšçš„æ˜¯è¦æ±‚å®‰å…¨ç­‰çº§æ¯”è¾ƒé«˜çš„é¡¹ç›®ï¼Œéœ€è¦è€ƒè™‘é‡‡ç”¨ <code>https</code> åè®®ï¼Œå¹¶å¯¹å…³é”®æ•°æ®è¿›è¡ŒåŠ å¯†åä¼ è¾“ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨éå¯¹ç§°å¯†ç ç®—æ³•è¿›è¡ŒåŠ è§£å¯†ã€‚</p> <p>æœ¬ç¯‡ï¼Œæˆ‘ä»¬ä¸»è¦ä¼šé’ˆå¯¹ Shiro æ¡†æ¶åšä¸€ä¸ªç®€å•çš„æ‰©å±•äº†è§£ï¼Œç„¶åå†åˆçª¥ RuoYi çš„èœå•ã€æƒé™åŠŸèƒ½ã€‚
</p> <h2 id="shiro"><a href="#shiro" class="header-anchor">#</a> Shiro</h2> <p>Shiro çš„å®˜ç½‘ä¸º <a href="https://shiro.apache.org/" target="_blank" rel="noopener noreferrer">Apache Shiro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼ŒGitHub ä»“åº“ä¸º <a href="https://github.com/apache/shiro" target="_blank" rel="noopener noreferrer">Shiro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>Shiro çš„è‡ªæˆ‘ä»‹ç»ä¸ºï¼šApache Shiroâ„¢ æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„ Java å®‰å…¨æ¡†æ¶ï¼Œå¯æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚ä½¿ç”¨ Shiro æ˜“äºç†è§£çš„ APIï¼Œä½ å¯ä»¥å¿«é€Ÿè½»æ¾åœ°ä¿æŠ¤ä»»ä½•åº”ç”¨ç¨‹åºâ€”â€”ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ web å’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚</p> <p>Shiro é«˜å±‚æ¶æ„ï¼Œå¦‚ä¸‹å›¾ï¼š</p> <p><img src="/assets/img/ruoyi/3/ShiroBasicArchitecture.png" alt="Shiro"></p> <p>Shiro æœ‰ä¸‰ä¸ªä¸»è¦æ¦‚å¿µï¼š<code>Subject</code>ã€<code>SecurityManager</code> å’Œ <code>Realms</code>ã€‚è¿™å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬åœ¨ä¸Šç¯‡ä¸­å¯¹ RuoYi çš„ç™»å½•åˆ†æä¸­å·²æœ‰æ‰€æ¥è§¦ã€‚</p> <p>ä¸‰å¤§æ¦‚å¿µï¼Œå®˜æ–¹å¤§ä½“çš„ä»‹ç»å¦‚ä¸‹ï¼š</p> <ul><li><code>Subject</code>ï¼šæœ¬è´¨ä¸Šæ˜¯å½“å‰æ‰§è¡Œç”¨æˆ·çš„ç‰¹å®šäºå®‰å…¨çš„â€œè§†å›¾â€ï¼Œå®ƒä»£è¡¨çš„å¯ä»¥æ˜¯äººï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºç¬¬ä¸‰æ–¹æœåŠ¡ã€å®ˆæŠ¤ç¨‹åºå¸æˆ·ã€cron job æˆ–ä»»ä½•ç±»ä¼¼çš„ä¸œè¥¿ã€‚</li> <li><code>SecurityManager</code>ï¼š<code>SecurityManager</code> æ˜¯ Shiro æ¶æ„çš„æ ¸å¿ƒï¼Œå®ƒå……å½“äº†ä¸€ç§â€œä¿æŠ¤ä¼â€å¯¹è±¡ï¼Œåè°ƒå…¶å†…éƒ¨å®‰å…¨ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å…±åŒå½¢æˆä¸€ä¸ªå¯¹è±¡å›¾ã€‚ç„¶è€Œï¼Œä¸€æ—¦ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºé…ç½®äº† <code>SecurityManager</code> åŠå…¶å†…éƒ¨å¯¹è±¡å›¾ï¼Œå®ƒé€šå¸¸å°±ä¸å­˜åœ¨äº†ï¼Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å‡ ä¹æ‰€æœ‰çš„æ—¶é—´éƒ½åœ¨ä½¿ç”¨ <code>Subject</code> APIã€‚</li> <li><code>Realms</code>ï¼š<code>Realms</code> å……å½“ Shiro å’Œåº”ç”¨ç¨‹åºå®‰å…¨æ•°æ®ä¹‹é—´çš„â€œæ¡¥æ¢â€æˆ–â€œè¿æ¥å™¨â€ã€‚å½“éœ€è¦ä¸å®‰å…¨ç›¸å…³æ•°æ®ï¼ˆå¦‚ç”¨æˆ·å¸æˆ·ï¼‰è¿›è¡Œå®é™…äº¤äº’ä»¥æ‰§è¡Œèº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰å’Œæˆæƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰æ—¶ï¼ŒShiro ä¼šä»ä¸ºåº”ç”¨ç¨‹åºé…ç½®çš„ä¸€ä¸ªæˆ–å¤šä¸ª <code>Realms</code> ä¸­æŸ¥æ‰¾è®¸å¤šè¿™äº›å†…å®¹ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼ŒRealm æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å®šäºå®‰å…¨çš„ DAOã€‚</li></ul> <p>ä»ä»¥ä¸Šçš„æ¦‚å¿µæè¿°ä¸­ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>Subject</code> ä»£è¡¨è®¤è¯ç›¸å…³çš„äººæˆ–è€…åº”ç”¨ï¼›<code>SecurityManager</code> æ˜¯ç”¨äºè®¤è¯çš„æ ¸å¿ƒåŠæ¡¥æ¢ï¼›<code>Realms</code> åˆ™ä»£è¡¨ç”¨äºè®¤è¯çš„ç›¸å…³æ•°æ®åŠè®¤è¯æ–¹æ³•çš„æä¾›è€…ã€‚</p> <p>å†çœ‹ä¸€ä¸‹ Shiro çš„è¯¦ç»†æ¶æ„ï¼Œå¦‚ä¸‹å›¾ï¼š</p> <p><img src="/assets/img/ruoyi/3/ShiroArchitecture.png" alt="Shiro"></p> <p>è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°æ›´å¤šå…³äº <code>SecurityManager</code> çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠå¸¸è§çš„ <code>Realms</code> çš„è®¤è¯æ•°æ®æ¥æºï¼Œè¯¦ç»†æˆ‘ä»¬ä¸å†å±•å¼€ã€‚</p> <h2 id="ruoyi-é‡Œçš„-shiro"><a href="#ruoyi-é‡Œçš„-shiro" class="header-anchor">#</a> RuoYi é‡Œçš„ Shiro</h2> <p>RuoYi é¡¹ç›®é‡Œå¯¹æ¥ä½¿ç”¨ Shiro çš„ä»£ç ï¼Œæ”¾åœ¨é¡¹ç›® <code>ruoyi-framework</code> ä¸­ï¼Œ åŒ…ä¸º <code>com.ruoyi.framework.shiro</code>ã€‚å…¶ä¸­æ¶‰åŠå®šä¹‰çš„ Realms å®ç°ç±» <code>UserRealm</code>ï¼Œå°†ç±»ç»§æ‰¿è‡ª <code>AuthorizingRealm</code>ï¼Œ<code>AuthorizingRealm</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶ä¸­æŠ½è±¡æ–¹æ³•ä¸ºï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">/**
     * Retrieves the AuthorizationInfo for the given principals from the underlying data store.  When returning
     * an instance from this method, you might want to consider using an instance of
     * {@link org.apache.shiro.authz.SimpleAuthorizationInfo SimpleAuthorizationInfo}, as it is suitable in most cases.
     *
     * @param principals the primary identifying principals of the AuthorizationInfo that should be retrieved.
     * @return the AuthorizationInfo associated with this principals.
     * @see org.apache.shiro.authz.SimpleAuthorizationInfo
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åŒæ—¶ï¼Œ<code>AuthorizingRealm</code> è¿˜ç»§ç»­è‡ª <code>AuthenticatingRealm</code>ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶æŠ½è±¡æ–¹æ³•ä¸ºï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">/**
     * Retrieves authentication data from an implementation-specific datasource (RDBMS, LDAP, etc) for the given
     * authentication token.
     * &lt;p/&gt;
     * For most datasources, this means just 'pulling' authentication data for an associated subject/user and nothing
     * more and letting Shiro do the rest.  But in some systems, this method could actually perform EIS specific
     * log-in logic in addition to just retrieving data - it is up to the Realm implementation.
     * &lt;p/&gt;
     * A {@code null} return value means that no account could be associated with the specified token.
     *
     * @param token the authentication token containing the user's principal and credentials.
     * @return an {@link AuthenticationInfo} object containing account data resulting from the
     *         authentication ONLY if the lookup is successful (i.e. account exists and is valid, etc.)
     * @throws AuthenticationException if there is an error acquiring data or performing
     *                                 realm-specific authentication logic for the specified &lt;tt&gt;token&lt;/tt&gt;
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">;</span>
</code></pre></div><p><code>UserRealm</code> å¯¹ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•çš„å®ç°åˆ†åˆ«å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">/**
     * æˆæƒ
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> arg0<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token class-name">ShiroUtils</span><span class="token punctuation">.</span><span class="token function">getSysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§’è‰²åˆ—è¡¨</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åŠŸèƒ½åˆ—è¡¨</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> menus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            info<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">&quot;*:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            roles <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">selectRoleKeys</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            menus <span class="token operator">=</span> menuService<span class="token punctuation">.</span><span class="token function">selectPermsByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è§’è‰²åŠ å…¥AuthorizationInfoè®¤è¯å¯¹è±¡</span>
            info<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æƒé™åŠ å…¥AuthorizationInfoè®¤è¯å¯¹è±¡</span>
            info<span class="token punctuation">.</span><span class="token function">setStringPermissions</span><span class="token punctuation">(</span>menus<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">/**
     * ç™»å½•è®¤è¯
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">UsernamePasswordToken</span> upToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> upToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>upToken<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            password <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>upToken<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            user <span class="token operator">=</span> loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CaptchaException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UserNotExistsException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAccountException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UserPasswordNotMatchException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IncorrectCredentialsException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UserPasswordRetryLimitExceedException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExcessiveAttemptsException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UserBlockedException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedAccountException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RoleBlockedException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedAccountException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯¹ç”¨æˆ·[&quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot;]è¿›è¡Œç™»å½•éªŒè¯..éªŒè¯æœªé€šè¿‡{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SimpleAuthenticationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>doGetAuthorizationInfo(PrincipalCollection arg0)</code> ä»£ç å°±æ˜¯è·å¾—ä¸€ä¸ª <code>SysUser</code> å¯¹è±¡ï¼Œå¹¶ç»™å®šç›¸åº”çš„èœå•å’Œç”¨æˆ·è§’è‰²ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·å’Œæƒé™å’Œèœå•ç»‘å®šéƒ½æ˜¯åœ¨è¿™é‡Œå®Œæˆçš„ï¼Œè€Œå…¶ä¸­æœ€æ ¸å¿ƒçš„ç”¨æˆ·æ•°æ®æ˜¯ä»ä»è€Œæ¥å‘¢ï¼Ÿç»§ç»­çœ‹ä»¥ä¸‹æ ¸å¿ƒçš„ä¸€å¥ä»£ç ï¼Œå¹¶è·Ÿè¸ªè¿›å»ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token class-name">ShiroUtils</span><span class="token punctuation">.</span><span class="token function">getSysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SysUser</span> <span class="token function">getSysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyBeanProp</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·ä¿¡æ¯æ¥æºäº <code>getPrincipal()</code>ï¼Œè€Œå®ƒæ¥è‡ªäº <code>getProject()</code>ï¼Œç»§ç»­è·Ÿè¿›ï¼Œå¯ä»¥æ‰¾åˆ°ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroUtils</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Subject</span> <span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>è·Ÿè¿›ï¼Œæ‰¾åˆ° <code>SecurityUtils</code> ç±»é‡Œçš„ä»£ç å®ç°ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Subject</span> <span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">ThreadContext</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        subject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subject<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadContext</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> subject<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤å¤„é€»è¾‘ä¸ºï¼šä» <code>ThreadContext.getSubject()</code> ä¸­è·å– <code>Subject</code>ï¼Œå¦‚æœå…¶ä¸º <code>null</code> åˆ™ç›´æ¥æ„å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å­˜å…¥ <code>ThreadContext</code> ä¸­ã€‚è¿›å…¥ <code>buildSubject()</code> çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Subject</span> <span class="token function">buildSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>securityManager<span class="token punctuation">.</span><span class="token function">createSubject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subjectContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å†è·Ÿè¿› <code>UserRealm</code> å¦ä¸€ä¸ªå®ç°çš„æ–¹æ³• <code>doGetAuthenticationInfo(AuthenticationToken token)</code>ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ–¹æ³•å®ç°äº†çœŸæ­£çš„ç™»å½•è®¤è¯ï¼Œå°†å¾…è®¤è¯ä¿¡æ¯ä¸è®¤è¯æºçš„æ•°æ®è¿›è¡Œè®¤è¯å¯¹æ¯”ï¼Œç¡®è®¤ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¤è¯é€šè¿‡ã€‚</p> <p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬é‡æ–°å›åˆ° RuoYi ä¸šåŠ¡ä¸­çš„ç™»å½•æ–¹æ³• <code>ajaxLogin</code>ï¼Œè§‚å¯Ÿç™»å½•ä¸šåŠ¡åˆ°åº•æ˜¯æ€ä¹ˆé€šè¿‡ Shiro æ¡†æ¶å®ç°çš„ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> rememberMe<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span>
<span class="token punctuation">{</span>
    subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œå¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼Œæ­¤å¤„ä½¿ç”¨äº†ä¸Šæ–‡æåˆ°çš„æ–¹æ³• <code>SecurityUtils.getSubject()</code> æ¥ç”Ÿæˆ <code>Subject</code>ï¼Œç„¶åå¯¹ç”Ÿæˆçš„ <code>Subject</code> å¯¹è±¡æ‰§è¡Œç™»å½•æ“ä½œã€‚é‚£æ­¤å¤„é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼šåœ¨é¡¹ç›®åˆå§‹åŒ–é…ç½®æ—¶ï¼Œ<code>SecurityManager</code> å°±å·²ç»ä¸ <code>UserRealm</code> æå‰ç»‘å®šï¼Œå½“ç”¨æˆ·è§¦å‘åˆ°ç™»å½•æ—¶ï¼Œä»£ç ä¸­ä½¿ç”¨ <code>SecurityManager</code> ç”Ÿæˆäº†ä¸€ä¸ª <code>Subject</code> å¯¹è±¡ï¼Œå†é€šè¿‡ <code>Subject</code> å®šä¹‰çš„ <code>login</code> æ–¹æ³•è¿›è¡Œäº†ç™»å½•æ“ä½œï¼Œè€Œ <code>login</code> æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ€ç»ˆä¼šè¿è¡Œåˆ°æˆ‘ä»¬ä¸Šé¢åˆ†æåˆ°çš„ <code>UserRealm</code> ä¸­çš„ <code>doGetAuthenticationInfo(AuthenticationToken token)</code> æ–¹æ³•ï¼Œæœ€ç»ˆç™»å½•æˆåŠŸçš„è¯ï¼ŒShiro æ¡†æ¶ä¼šä¸º <code>Subject</code> å¯¹è±¡æ·»åŠ è®¤è¯ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ã€‚</p> <p>é€šè¿‡ä»¥ä¸Šçš„ä»£ç æ¢³ç†å’Œåˆ†æï¼Œæˆ‘ä»¬èƒ½æ¯”è¾ƒæ¸…æ™°åœ°ä½“ä¼šåˆ° Shiro ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µçš„ç”¨é€”ã€‚<code>Realm</code> å°±æ˜¯ç”¨æ¥æ¯”è¾ƒè®¤è¯ä¿¡æ¯æ˜¯å¦åˆæ³•çš„ï¼Œæ ¸å¿ƒå°±æ˜¯æä¾›è®¤è¯æºç”¨äºå¯¹æ¯”ï¼›<code>SecurityManager</code> ä¸ <code>Realm</code> æå‰ç»‘å®šï¼Œæä¾›è®¤è¯ API ç»™ä¸šåŠ¡ä½¿ç”¨ï¼Œä¸šåŠ¡ <code>Subject</code> çš„ <code>login</code> æ–¹æ³•ï¼Œå®ç°æœ€ç»ˆé€šè¿‡ <code>SecurityManger</code> è°ƒç”¨ <code>Realm</code> ä¸­çš„è®¤è¯æ–¹æ³•è¿›è¡Œç™»å½•ï¼Œå¹¶èµ‹äºˆ <code>Subject</code> å¯¹è±¡ç›¸å…³æ•°æ®ï¼Œæœ€ç»ˆå¯é€šè¿‡ <code>SecurityManager</code> è·å¾—ç”¨æˆ·ç›¸å…³æ•°æ®å¯¹è±¡ <code>Subject</code>ï¼Œå¹¶èƒ½ä» <code>Subject</code> ä¸­è·å–è‡ªå·±éœ€è¦çš„å„ç§ç”¨æˆ·ä¿¡æ¯ã€‚</p> <h2 id="åˆè§-rbac"><a href="#åˆè§-rbac" class="header-anchor">#</a> åˆè§ RBAC</h2> <p>åœ¨ä¸Šé¢ç™»å½•é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ <code>UserRealm</code> ä¸­ç™»å½•æˆåŠŸåï¼Œå¯¹ç”¨æˆ·è¿›è¡Œèœå•å’Œæƒé™çš„ç»‘å®šæ“ä½œã€‚ä½†æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯è¿™æ®µä»£ç ï¼Œè®©äººæ„Ÿè§‰ç–‘æƒ‘ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>roles <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">selectRoleKeys</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
menus <span class="token operator">=</span> menuService<span class="token punctuation">.</span><span class="token function">selectPermsByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è§’è‰²åŠ å…¥AuthorizationInfoè®¤è¯å¯¹è±¡</span>
info<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æƒé™åŠ å…¥AuthorizationInfoè®¤è¯å¯¹è±¡</span>
info<span class="token punctuation">.</span><span class="token function">setStringPermissions</span><span class="token punctuation">(</span>menus<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘ä»¬å¾ˆæ˜æ˜¾çš„å¯ä»¥çœ‹åˆ° <code>info</code> å¯¹è±¡çš„ä¸¤ä¸ªæ–¹æ³•ä¸º <code>setRoles()</code>ï¼ˆè®¾ç½®è§’è‰²ï¼‰ã€<code>SetStringPermissions()</code>ï¼ˆè®¾ç½®æƒé™ï¼‰ï¼Œä½†ä½œè€…åœ¨è¿™å¤„å¯¹è®¾ç½®æƒé™å‡½æ•°æ·»åŠ çš„æ•°æ®ï¼Œå‘½åä¸º <code>menus</code>ï¼ˆèœå•ï¼‰ã€‚æˆ‘ä»¬åªèƒ½æœ‰ä¸€ä¸ªåˆæ­¥çŒœæµ‹ï¼šRuoYi ç³»ç»Ÿä¸­ï¼Œæ˜¯å¦æ²¡æœ‰é’ˆå¯¹ API çº§åˆ«çš„æƒé™æ§åˆ¶ï¼Œè€Œåªæ˜¯é’ˆå¯¹èœå•çº§è¿›è¡Œäº†æ§åˆ¶å‘¢ï¼Ÿ</p> <p>å¦å¤–ï¼Œ<code>SysRole</code> éƒ½æœ‰äº›ä»€ä¹ˆå±æ€§ï¼Œåˆæ˜¯æ€ä¹ˆå¯¹ç”¨æˆ·æ“ä½œè¿›è¡Œæƒé™æ§åˆ¶çš„å‘¢ï¼Ÿèœå•æ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„ï¼Œåˆæ˜¯æ€ä¹ˆè¿›è¡Œè®¿é—®æ§åˆ¶çš„å‘¢ï¼Ÿè¿™äº› RBAC ç›¸å…³ç–‘é—®çš„è§£ç­”ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ç¯‡å±•å¼€ã€‚</p> <h2 id="å°ç»“"><a href="#å°ç»“" class="header-anchor">#</a> å°ç»“</h2> <p>æœ¬ç¯‡ä¸­æˆ‘ä»¬ç®€å•çš„æ‰©å±•äº†ä¸€ä¸‹ Shiro æ¡†æ¶çš„ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ç»“åˆ Shiro æ¡†æ¶åˆ†æäº† RuoYi é¡¹ç›®å¦‚ä½•å¯¹æ¥ä½¿ç”¨çš„ Shiro æ¡†æ¶ã€‚</p> <p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨å¯¹æ¥ä»£ç ä¸­å‘ç°äº† RBAC æ¯”è¾ƒæ ¸å¿ƒçš„æƒé™ã€èœå•ç­‰æ•°æ®ã€‚RBAC ç¥ç§˜çš„é¢çº±æ‰åˆšæ­å¼€ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡ç»§ç»­ã€‚æœ¬ç¯‡å°±åˆ°è¿™é‡Œï¼Œæ¯”å¿ƒï¼Œâ¤ã€‚</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      å‘å¸ƒæ—¶é—´ : 2022-11-12
    </span> <!----></section> <section class="post-links" data-v-4e23451f><a href="/posts/2022/10/28/ruoyi-2.html" class="post-link" data-v-4e23451f>
      ä¸Šä¸€ç¯‡ : æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹äºŒ
    </a> <a href="/posts/2022/11/23/ruoyi-4.html" class="post-link" data-v-4e23451f>
      ä¸‹ä¸€ç¯‡ : æœ€ç«åå°ç®¡ç†ç³»ç»Ÿ RuoYi é¡¹ç›®æ¢ç§˜ï¼Œä¹‹å››
    </a></section></section> <!----></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" data-v-9d847660><img src="https://images.bookhub.tech/mp/avatar.jpg" alt="é˜¿å‘œ" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      é˜¿å‘œ
    </section> <section class="info-desc" data-v-9d847660>â€ğŸ“¢äº‘åŸç”Ÿæ¡†æ¶ Micronaut æ¨å¹¿è€…<br/>â˜ï¸äº‘è®¡ç®—ä»ä¸šè€…<br/>ğŸŒ±é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ<br/>â˜˜ï¸ç³»ç»Ÿæ¶æ„å¸ˆ<br/>ğŸ’»ä¸ªäººç©ºé—´ï¼š<a href="https://luansheng.fun">https://luansheng.fun</a><br/>ğŸ“±å…¬ä¼—å·ï¼šç¨‹åºå‘˜çˆ±è¯»ä¹¦</br><img src="https://images.bookhub.tech/mp/mp.png" width="60%"/></section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="ä¸­å›½Â·æˆéƒ½" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>ä¸­å›½Â·æˆéƒ½</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          ä¸­å›½Â·æˆéƒ½
        </span></span></section> <section data-v-9d847660><span title="MortNon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>MortNon</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          MortNon
        </span></span></section> <section data-v-9d847660><a href="mailto:mortnon@outlook.com" title="mortnon@outlook.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>mortnon@outlook.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          mortnon@outlook.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/dev2007" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: dev2007" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: dev2007</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a><a href="https://juejin.cn/user/2620868693599405" target="_blank" class="sns-link" data-v-9d847660><span title="æ˜é‡‘: dev2007" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>æ˜é‡‘: dev2007</title><use xlink:href="#icon-juejin" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>æ–‡ç« ç›®å½•</span> <div class="post-nav-toc"><ul><li><a href="/posts/2022/11/12/ruoyi-3.html#shiro">Shiro</a></li><li><a href="/posts/2022/11/12/ruoyi-3.html#ruoyi-é‡Œçš„-shiro">RuoYi é‡Œçš„ Shiro</a></li><li><a href="/posts/2022/11/12/ruoyi-3.html#åˆè§-rbac">åˆè§ RBAC</a></li><li><a href="/posts/2022/11/12/ruoyi-3.html#å°ç»“">å°ç»“</a></li></ul></div></div> <!----></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/dev2007" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: dev2007" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: dev2007</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a><a href="https://juejin.cn/user/2620868693599405" target="_blank" class="sns-link" data-v-1375e54c><span title="æ˜é‡‘: dev2007" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>æ˜é‡‘: dev2007</title><use xlink:href="#icon-juejin" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <!----> <p class="footer-text" data-v-1375e54c><div style="display:flex;flex-direction:column"><span>&copy; 2022~2024 é˜¿å‘œ</span>
        <div style="display:flex;flex-direction:row;justify-content:center">
        <a href="https://beian.miit.gov.cn" target="_blank" style="color: rgb(102, 102, 102);" onmouseover="this.style.color='rgb(30, 144, 255)'" onmouseout="this.style.color='rgb(102,102,102)'">èœ€ICPå¤‡2024097210å·</a>
        <div style="display:flex;align-items:center;margin-left:8px">
        <img src="logo01.png" style="width:16px;height:16px">
        <a href="https://beian.mps.gov.cn/#/query/webSearch?code=51018002000252" target="_blank" style="color: rgb(102, 102, 102);" onmouseover="this.style.color='rgb(30, 144, 255)'" onmouseout="this.style.color='rgb(102,102,102)'">å·å…¬ç½‘å®‰å¤‡51018002000252å·</a>
        </div>
        </div></div></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.467e2829.js" defer></script><script src="/assets/js/7.4e539d82.js" defer></script><script src="/assets/js/59.67f1a597.js" defer></script>
  </body>
</html>
